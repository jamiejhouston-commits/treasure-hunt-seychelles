# 🏴‍☠️ TREASURE HUNT - PROPER MINTING WORKFLOW

**Status:** Database cleaned ✅ | Ready for proper minting

---

## 📋 WHAT WE FIXED

### ❌ What Was Wrong:
- Synced unminted NFTs directly to database
- Bypassed IPFS upload and minting
- Would show unlimited NFTs in Gallery Minted

### ✅ What's Fixed Now:
- **Database cleaned** - All 100 unminted Chapter 1 NFTs removed
- **Files preserved** - 20 NFTs with layers still in `content/treasure_hunt_chapter1/`
- **Ready for proper workflow** - Upload → Mint → Sync → Display

---

## 🚀 PROPER MINTING WORKFLOW

### Step 1: Upload to IPFS and Prepare Minting
```bash
cd "C:\Users\andre\The Levasseur Treasure of Seychelles"
node scripts/prepare_treasure_hunt_mint.mjs
```

**This will:**
- Upload 20 base images to Pinata IPFS
- Upload 4 puzzle layer overlays to Pinata IPFS
- Create metadata with IPFS hashes
- Upload metadata to Pinata IPFS
- Generate `data/treasure_hunt_mint_input.json`

**Output:** Mint input file with all IPFS hashes

---

### Step 2: Mint to XRPL Testnet

**Option A: Use Existing Minting Script**
```bash
# If you have a working minting script:
node scripts/run_mint.mjs --input data/treasure_hunt_mint_input.json
```

**Option B: Use Your Current Workflow**
- Take the IPFS hashes from mint input file
- Use your existing testnet minting process
- Mint all 20 NFTs

---

### Step 3: Sync Minted NFTs to Database

**After minting completes**, run the sync script with ACTUAL nftoken_ids:

```bash
cd backend
node sync_minted_treasure_hunt.js
```

This script will:
- Query XRPL for your minted NFTs
- Match them to the treasure hunt metadata
- Insert into database with:
  - Real nftoken_id
  - IPFS image URLs
  - Layer data
  - Puzzle configuration
  - Art rarity

---

### Step 4: Verify in Gallery Minted

1. Start servers:
```bash
# Terminal 1: Backend
cd backend
node server.js

# Terminal 2: Frontend  
cd frontend
npm start
```

2. Open http://localhost:3000/gallery-minted
3. Should see exactly 20 NFTs (not 100!)
4. Each NFT shows rarity badge
5. Click to open Layer Viewer
6. Puzzle NFTs (#5, #12, #17, #20) have toggleable layers

---

## 📁 FILE STRUCTURE

```
content/treasure_hunt_chapter1/
├── images/                        # 20 base artworks (ready)
│   └── nft_1.png ... nft_20.png
├── layers/                        # 4 puzzle overlays (ready)
│   ├── nft_5_layer_1.png
│   ├── nft_12_layer_2.png
│   ├── nft_17_layer_3.png
│   └── nft_20_layer_1.png
├── metadata/                      # Will be updated with IPFS hashes
│   └── nft_1.json ... nft_20.json
└── collection_metadata.json       # Source data

data/
└── treasure_hunt_mint_input.json  # Generated by Step 1
```

---

## ⚙️ SCRIPTS CREATED

### 1. `prepare_treasure_hunt_mint.mjs` (NEW)
**Purpose:** Upload to IPFS and prepare for minting  
**Run:** `node scripts/prepare_treasure_hunt_mint.mjs`  
**Output:** `data/treasure_hunt_mint_input.json`

### 2. `cleanup_chapter1_nfts.js` (NEW)
**Purpose:** Remove unminted NFTs from database  
**Run:** `node backend/cleanup_chapter1_nfts.js`  
**Status:** ✅ Already executed

### 3. `sync_treasure_hunt_nfts.js` (EXISTS, DON'T USE YET)
**Purpose:** Sync to database AFTER minting  
**Run:** `node backend/sync_treasure_hunt_nfts.js`  
**Status:** ⚠️ Wait until after minting

---

## 🔑 REQUIREMENTS

### Environment Variables (.env)
```env
PINATA_API_KEY=your_key_here
PINATA_API_SECRET=your_secret_here
XRPL_NETWORK=testnet
XRPL_WALLET_SEED=your_testnet_seed
```

### Pinata Account
- Sign up at https://pinata.cloud
- Get API keys
- Add to .env file

---

## ✅ CHECKLIST

### Pre-Minting:
- [x] 20 NFTs generated with layers and rarity
- [x] Database cleaned (unminted NFTs removed)
- [x] Frontend axios error fixed
- [x] Upload script created
- [ ] Pinata credentials in .env
- [ ] Run prepare_treasure_hunt_mint.mjs

### Minting:
- [ ] Upload to IPFS completed
- [ ] Mint input file generated
- [ ] 20 NFTs minted to testnet
- [ ] Minting transactions confirmed

### Post-Minting:
- [ ] Sync minted NFTs to database
- [ ] Verify in Gallery Minted (exactly 20 NFTs)
- [ ] Test Layer Viewer on all NFTs
- [ ] Test puzzle submission page
- [ ] Verify rarity badges display

---

## 🚨 IMPORTANT NOTES

### DO NOT:
- ❌ Sync to database before minting
- ❌ Skip IPFS upload step
- ❌ Manually insert NFTs into database

### DO:
- ✅ Upload to IPFS first
- ✅ Mint to testnet with real transactions
- ✅ Sync with actual nftoken_ids
- ✅ Follow the proper workflow order

---

## 🎯 CURRENT STATUS

```
✅ NFT Generation     - 20 NFTs with layers created
✅ Database Cleanup   - Unminted NFTs removed
✅ Frontend Fixed     - Axios error resolved
⏳ IPFS Upload       - NEXT STEP
⏳ Minting           - After IPFS
⏳ Database Sync     - After minting
⏳ Testing           - After sync
```

---

## 🚀 START NOW

**Ready to begin proper workflow:**

```bash
# Step 1: Upload to IPFS
cd "C:\Users\andre\The Levasseur Treasure of Seychelles"
node scripts/prepare_treasure_hunt_mint.mjs

# Then follow Steps 2-4 above
```

**After this completes successfully, you'll have:**
- 20 NFTs on XRPL testnet
- Properly synced to database
- Displaying in Gallery Minted
- All features working correctly

---

**Ready when you are! 🏴‍☠️**
